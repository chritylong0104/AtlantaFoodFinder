{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1>Welcome to ATL Restaurant Finder</h1>

<!-- Search bar -->
<form method="get" action="{% url 'restaurant_search' %}">
    <input type="text" name="search_query" placeholder="Search restaurants">
    <button type="submit">Search</button>
</form>

<!-- Filter options -->
<form method="get" action="{% url 'restaurant_search' %}">
    <input type="text" name="cuisine_type" placeholder="Cuisine type">
    <input type="number" name="min_rating" placeholder="Minimum rating">
    <input type="number" name="max_distance" placeholder="Maximum distance (km)">
    <button type="submit">Filter</button>
</form>

<!-- Error handling -->
{% if error %}
    <p class="error">{{ error }}</p>
{% endif %}

<!-- Search Results -->
{% if search_results %}
    <h2>Search Results</h2>
    <div class="search-results">
        {% for restaurant in search_results %}
        <div class="restaurant-card">
            <h3>{{ restaurant.name }}</h3>
            <div class="restaurant-photos">
                {% for photo_url in restaurant.photos %}
                    <img src="{{ photo_url }}" alt="{{ restaurant.name }}" class="restaurant-photo">
                {% endfor %}
            </div>
            <p>Address: {{ restaurant.address }}</p>
            <p>Rating: {{ restaurant.rating }}</p>
            {% if restaurant.distance %}
                <p>Distance: {{ restaurant.distance }} km</p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
{% endif %}

<!-- Suggested Restaurants -->
<h2>Suggested Restaurants</h2>
<div id="map" style="height: 400px; width: 100%;"></div>
<div class="restaurant-cards">
    {% for restaurant in suggested_restaurants %}
    <div class="card">
        <a href="{% url 'restaurant_detail' restaurant.place_id %}">
            {% if restaurant.photo %}
                <img src="{{ restaurant.photo }}" alt="{{ restaurant.name }}" class="card-img-top">
            {% else %}
                <img src="{% static 'images/default_restaurant.jpg' %}" alt="{{ restaurant.name }}" class="card-img-top">
            {% endif %}
            <div class="card-body">
                <h4 class="card-title">{{ restaurant.name }}</h4>
                <p class="card-text">{{ restaurant.address }}</p>
                <p class="card-text">Rating: {{ restaurant.rating }}</p>
            </div>
        </a>
    </div>
    {% empty %}
    <p>No restaurants found.</p>
    {% endfor %}
</div>

<script>
function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 33.7490, lng: -84.3880},  // Atlanta coordinates
        zoom: 11
    });

    {% for restaurant in suggested_restaurants %}
    var marker = new google.maps.Marker({
        position: {lat: {{ restaurant.geolocation.lat }}, lng: {{ restaurant.geolocation.lng }}},
        map: map,
        title: '{{ restaurant.name }}'
    });
    {% endfor %}

    {% if search_results %}
        {% for restaurant in search_results %}
        var marker = new google.maps.Marker({
            position: {lat: {{ restaurant.geolocation.lat }}, lng: {{ restaurant.geolocation.lng }}},
            map: map,
            title: '{{ restaurant.name }}'
        });
        {% endfor %}
    {% endif %}
}
</script>
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&callback=initMap">
</script>

<style>
.restaurant-photos {
    display: flex;
    overflow-x: auto;
    gap: 10px;
    margin-bottom: 10px;
}

.restaurant-photo {
    width: 200px;
    height: 150px;
    object-fit: cover;
}

.restaurant-card, .card {
    border: 1px solid #ddd;
    padding: 10px;
    margin-bottom: 20px;
    border-radius: 5px;
}

.restaurant-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
}
</style>
{% endblock %}